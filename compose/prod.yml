version: "3.4"

services:
  traefik:
    ports:
      - target: 80
        published: 80
        protocol: tcp
        mode: ingress # ingress makes it globally avialable over all swarm mode
      - target: 443
        published: 443
        protocol: tcp
        mode: ingress
        # webui for traefik
      - target: 8080
        published: 8080
        protocol: tcp
        mode: ingress
    configs:
      - source: traefik_config
        target: /etc/traefik/traefik.toml
        uid: '1'
        gid: '1'
        mode: 0700

  rest-api:
    deploy:
      labels:
        # set us up with traefik
        - "traefik.enable=true"
        - "traefik.backend=rest-api"
        #which hosts to get ssl certificates for, and route traffic for.
        - "traefik.frontend.rule=Host:mjolnir.ngrid.me"
        # This needs to be the global network name(i think?)
        - "traefik.docker.network=mjolnir_frontend"
        #port this service is listening on.
        - "traefik.port=8080"


configs:
  traefik_config:
    file: ./traefik/config.toml
